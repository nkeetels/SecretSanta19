// Button Bashers Secret Santa 2019 Gameboy Advance demo source code
// 
// File: KDTypes.c
// Description: defines generic types for portability. However, it seems DevkitPro already covers this.

#include "KDEngine.h"
#include "KDMath.h"

// Horked this lookup-table from an old project that I did with Sgstair
const s16 SinLUT[] = {
0x0000, 0x0006, 0x000C, 0x0012, 0x0019, 0x001F, 0x0025, 0x002B, 0x0031, 0x0038,
0x003E, 0x0044, 0x004A, 0x0050, 0x0056, 0x005C, 0x0061, 0x0067, 0x006D, 0x0073,
0x0078, 0x007E, 0x0083, 0x0088, 0x008E, 0x0093, 0x0098, 0x009D, 0x00A2, 0x00A7,
0x00AB, 0x00B0, 0x00B5, 0x00B9, 0x00BD, 0x00C1, 0x00C5, 0x00C9, 0x00CD, 0x00D1,
0x00D4, 0x00D8, 0x00DB, 0x00DE, 0x00E1, 0x00E4, 0x00E7, 0x00EA, 0x00EC, 0x00EE,
0x00F1, 0x00F3, 0x00F4, 0x00F6, 0x00F8, 0x00F9, 0x00FB, 0x00FC, 0x00FD, 0x00FE,
0x00FE, 0x00FF, 0x00FF, 0x00FF, 0x0100, 0x00FF, 0x00FF, 0x00FF, 0x00FE, 0x00FE,
0x00FD, 0x00FC, 0x00FB, 0x00F9, 0x00F8, 0x00F6, 0x00F4, 0x00F3, 0x00F1, 0x00EE,
0x00EC, 0x00EA, 0x00E7, 0x00E4, 0x00E1, 0x00DE, 0x00DB, 0x00D8, 0x00D4, 0x00D1,
0x00CD, 0x00C9, 0x00C5, 0x00C1, 0x00BD, 0x00B9, 0x00B5, 0x00B0, 0x00AB, 0x00A7,
0x00A2, 0x009D, 0x0098, 0x0093, 0x008E, 0x0088, 0x0083, 0x007E, 0x0078, 0x0073,
0x006D, 0x0067, 0x0061, 0x005C, 0x0056, 0x0050, 0x004A, 0x0044, 0x003E, 0x0038,
0x0031, 0x002B, 0x0025, 0x001F, 0x0019, 0x0012, 0x000C, 0x0006, 0xFFFF, 0xFFF9,
0xFFF3, 0xFFED, 0xFFE6, 0xFFE0, 0xFFDA, 0xFFD4, 0xFFCE, 0xFFC7, 0xFFC1, 0xFFBB,
0xFFB5, 0xFFAF, 0xFFA9, 0xFFA3, 0xFF9E, 0xFF98, 0xFF92, 0xFF8C, 0xFF87, 0xFF81,
0xFF7C, 0xFF77, 0xFF71, 0xFF6C, 0xFF67, 0xFF62, 0xFF5D, 0xFF58, 0xFF54, 0xFF4F,
0xFF4A, 0xFF46, 0xFF42, 0xFF3E, 0xFF3A, 0xFF36, 0xFF32, 0xFF2E, 0xFF2B, 0xFF27,
0xFF24, 0xFF21, 0xFF1E, 0xFF1B, 0xFF18, 0xFF15, 0xFF13, 0xFF11, 0xFF0E, 0xFF0C,
0xFF0B, 0xFF09, 0xFF07, 0xFF06, 0xFF04, 0xFF03, 0xFF02, 0xFF01, 0xFF01, 0xFF00,
0xFF00, 0xFF00, 0xFF00, 0xFF00, 0xFF00, 0xFF00, 0xFF01, 0xFF01, 0xFF02, 0xFF03,
0xFF04, 0xFF06, 0xFF07, 0xFF09, 0xFF0B, 0xFF0C, 0xFF0E, 0xFF11, 0xFF13, 0xFF15,
0xFF18, 0xFF1B, 0xFF1E, 0xFF21, 0xFF24, 0xFF27, 0xFF2B, 0xFF2E, 0xFF32, 0xFF36,
0xFF3A, 0xFF3E, 0xFF42, 0xFF46, 0xFF4A, 0xFF4F, 0xFF54, 0xFF58, 0xFF5D, 0xFF62,
0xFF67, 0xFF6C, 0xFF71, 0xFF77, 0xFF7C, 0xFF81, 0xFF87, 0xFF8C, 0xFF92, 0xFF98,
0xFF9E, 0xFFA3, 0xFFA9, 0xFFAF, 0xFFB5, 0xFFBB, 0xFFC1, 0xFFC7, 0xFFCE, 0xFFD4,
0xFFDA, 0xFFE0, 0xFFE6, 0xFFED, 0xFFF3, 0xFFF9 };

void IWRAM_CODE Rotate(Matrix3x3 m, int x, int y, int z)
{
    int cx = (SinLUT[(x + 64) & 255]);
    int sx = (SinLUT[(x)&255]);
    int cy = (SinLUT[(y + 64) & 255]);;
    int sy = (SinLUT[(y)&255]);
    int cz = (SinLUT[(z + 64) & 255]);
    int sz = (SinLUT[(z)&255]);

    m[0][0] = ((cx * cz) >> 8) - ((sx * sy * sz) >> 16);
    m[0][1] = ((sx * cz) >> 8) + ((cx * sy * sz) >> 16);
    m[0][2] = ((cy * sz) >> 8);

    m[1][0] = -(sx * cy) >> 8;
    m[1][1] =  (cx * cy) >> 8;
    m[1][2] = -sy;

    m[2][0] = -((cx * sz) >> 8) - ((sx * sy * cz) >> 16);
    m[2][1] =  ((cx * sy* cz) >> 16) - ((sx * sz) >> 8);
    m[2][2] =  ((cy * cz) >> 8);
}